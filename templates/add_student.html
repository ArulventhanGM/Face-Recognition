{% extends "base.html" %}

{% block title %}{{ 'Edit' if student else 'Add' }} Student - Face Recognition System{% endblock %}

{% block content %}
<div class="container">
    <div class="card">
        <div class="card-header">
            <h1 class="card-title">
                <i class="fas fa-user-{{ 'edit' if student else 'plus' }}"></i>
                {{ 'Edit' if student else 'Add New' }} Student
            </h1>
            <a href="{{ url_for('students') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Back to Students
            </a>
        </div>
        
        <form method="POST" enctype="multipart/form-data">
            <div class="grid grid-2">
                <div>
                    <div class="form-group">
                        <label for="student_id" class="form-label">
                            <i class="fas fa-id-card"></i> Student ID *
                        </label>
                        <input type="text" 
                               id="student_id" 
                               name="student_id" 
                               class="form-control" 
                               value="{{ student.student_id if student else '' }}"
                               {{ 'readonly' if student else '' }}
                               required>
                        <small class="form-text">Alphanumeric, 3-20 characters</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="name" class="form-label">
                            <i class="fas fa-user"></i> Full Name *
                        </label>
                        <input type="text" 
                               id="name" 
                               name="name" 
                               class="form-control" 
                               value="{{ student.name if student else '' }}"
                               required>
                    </div>
                    
                    <div class="form-group">
                        <label for="email" class="form-label">
                            <i class="fas fa-envelope"></i> Email Address *
                        </label>
                        <input type="email" 
                               id="email" 
                               name="email" 
                               class="form-control" 
                               value="{{ student.email if student else '' }}"
                               required>
                    </div>
                    
                    <div class="form-group">
                        <label for="department" class="form-label">
                            <i class="fas fa-building"></i> Department *
                        </label>
                        <select id="department" name="department" class="form-control" required>
                            <option value="">Select Department</option>
                            <option value="Computer Science" {{ 'selected' if student and student.department == 'Computer Science' else '' }}>Computer Science</option>
                            <option value="Engineering" {{ 'selected' if student and student.department == 'Engineering' else '' }}>Engineering</option>
                            <option value="Business" {{ 'selected' if student and student.department == 'Business' else '' }}>Business</option>
                            <option value="Arts" {{ 'selected' if student and student.department == 'Arts' else '' }}>Arts</option>
                            <option value="Science" {{ 'selected' if student and student.department == 'Science' else '' }}>Science</option>
                            <option value="Mathematics" {{ 'selected' if student and student.department == 'Mathematics' else '' }}>Mathematics</option>
                            <option value="Physics" {{ 'selected' if student and student.department == 'Physics' else '' }}>Physics</option>
                            <option value="Chemistry" {{ 'selected' if student and student.department == 'Chemistry' else '' }}>Chemistry</option>
                            <option value="Biology" {{ 'selected' if student and student.department == 'Biology' else '' }}>Biology</option>
                            <option value="Other" {{ 'selected' if student and student.department == 'Other' else '' }}>Other</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="year" class="form-label">
                            <i class="fas fa-calendar"></i> Academic Year *
                        </label>
                        <select id="year" name="year" class="form-control" required>
                            <option value="">Select Year</option>
                            <option value="1" {{ 'selected' if student and student.year == '1' else '' }}>1st Year</option>
                            <option value="2" {{ 'selected' if student and student.year == '2' else '' }}>2nd Year</option>
                            <option value="3" {{ 'selected' if student and student.year == '3' else '' }}>3rd Year</option>
                            <option value="4" {{ 'selected' if student and student.year == '4' else '' }}>4th Year</option>
                            <option value="Graduate" {{ 'selected' if student and student.year == 'Graduate' else '' }}>Graduate</option>
                            <option value="Postgraduate" {{ 'selected' if student and student.year == 'Postgraduate' else '' }}>Postgraduate</option>
                        </select>
                    </div>
                </div>
                
                <div>
                    <div class="form-group">
                        <label for="face_image" class="form-label">
                            <i class="fas fa-camera"></i> Face Photo
                            {% if not student %} *{% endif %}
                        </label>
                        <div class="file-input-wrapper">
                            <input type="file" 
                                   id="face_image" 
                                   name="face_image" 
                                   accept="image/*"
                                   {% if not student %}required{% endif %}>
                            <i class="fas fa-upload"></i>
                            {{ 'Update face photo' if student else 'Upload clear face photo' }}
                        </div>
                        <small class="form-text">
                            Upload a clear, front-facing photo for face recognition.
                            Supported formats: JPG, PNG. Max size: 16MB.
                        </small>
                    </div>
                    
                    {% if student and has_face_data %}
                    <div class="alert alert-success">
                        <i class="fas fa-check-circle"></i>
                        Face data is already registered for this student.
                        Upload a new photo to update the face data.
                    </div>
                    {% endif %}
                    
                    <div class="form-group">
                        <h4>Face Recognition Guidelines</h4>
                        <ul style="list-style-type: disc; padding-left: 2rem;">
                            <li>Use a clear, high-resolution photo</li>
                            <li>Ensure good lighting conditions</li>
                            <li>Face should be front-facing</li>
                            <li>Remove glasses if possible</li>
                            <li>Neutral expression works best</li>
                            <li>No other people in the photo</li>
                            <li>Plain background preferred</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="d-flex gap-2 mt-4">
                <button type="submit" id="submitBtn" class="btn btn-success">
                    <i class="fas fa-save"></i>
                    {{ 'Update' if student else 'Register' }} Student
                </button>
                <a href="{{ url_for('students') }}" class="btn btn-secondary">
                    <i class="fas fa-times"></i> Cancel
                </a>
            </div>
        </form>
    </div>
    
    {% if student %}
    <!-- Student Information Card -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">
                <i class="fas fa-info-circle"></i>
                Current Information
            </h2>
        </div>
        
        <div class="grid grid-2">
            <div>
                <h4>Personal Details</h4>
                <table class="table">
                    <tr>
                        <td><strong>Student ID:</strong></td>
                        <td>{{ student.student_id }}</td>
                    </tr>
                    <tr>
                        <td><strong>Name:</strong></td>
                        <td>{{ student.name }}</td>
                    </tr>
                    <tr>
                        <td><strong>Email:</strong></td>
                        <td>{{ student.email }}</td>
                    </tr>
                    <tr>
                        <td><strong>Department:</strong></td>
                        <td>{{ student.department }}</td>
                    </tr>
                    <tr>
                        <td><strong>Year:</strong></td>
                        <td>{{ student.year }}</td>
                    </tr>
                    <tr>
                        <td><strong>Registered:</strong></td>
                        <td>{{ student.registration_date }}</td>
                    </tr>
                </table>
            </div>
            
            <div>
                <h4>Face Recognition Status</h4>
                {% if has_face_data %}
                <div class="alert alert-success">
                    <i class="fas fa-check-circle"></i>
                    <strong>Face data registered</strong><br>
                    This student can be recognized by the system.
                </div>
                {% else %}
                <div class="alert alert-warning">
                    <i class="fas fa-exclamation-triangle"></i>
                    <strong>No face data</strong><br>
                    Upload a face photo to enable recognition.
                </div>
                {% endif %}
                
                <h4 class="mt-3">Recent Attendance</h4>
                {% if recent_attendance %}
                <table class="table">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Time</th>
                            <th>Method</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for record in recent_attendance %}
                        <tr>
                            <td>{{ record.date }}</td>
                            <td>{{ record.time }}</td>
                            <td>
                                <span class="badge badge-{{ 'success' if record.method == 'camera' else 'warning' }}">
                                    {{ record.method.title() }}
                                </span>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {% else %}
                <p class="text-muted">No attendance records found.</p>
                {% endif %}
            </div>
        </div>
    </div>
    {% endif %}
</div>

<style>
.form-text {
    font-size: 0.875rem;
    color: #666;
    margin-top: 0.25rem;
    display: block;
}

.file-input-wrapper {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    justify-content: center;
    min-height: 120px;
}

.table td {
    padding: 0.5rem;
    border-bottom: 1px solid #eee;
}

.table tr:last-child td {
    border-bottom: none;
}
</style>
{% endblock %}
