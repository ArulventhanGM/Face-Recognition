{% extends "base.html" %}

{% block title %}Dashboard - Face Recognition System{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="glass-card">
        <div class="card-header" style="border-bottom: 1px solid var(--glass-border); margin-bottom: 20px; padding-bottom: 15px;">
            <h1 class="card-title" style="font-family: 'Orbitron', sans-serif; margin: 0; color: var(--text-primary);">
                <i class="fas fa-tachometer-alt" style="color: var(--accent-teal);"></i>
                Admin Dashboard
            </h1>
            <span class="badge" style="background-color: var(--accent-teal); padding: 5px 10px; border-radius: 5px;">Welcome, {{ current_user.username }}</span>
        </div>
        
        <!-- Statistics -->
        <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
            <div class="glass-card" style="padding: 15px; text-align: center;">
                <span class="stat-number" style="font-size: 2.5rem; font-weight: 700; color: var(--accent-teal); display: block; font-family: 'Orbitron', sans-serif;">{{ stats.total_students }}</span>
                <span class="stat-label" style="font-size: 1rem; color: var(--text-secondary);">Registered Students</span>
            </div>
            <div class="glass-card" style="padding: 15px; text-align: center;">
                <span class="stat-number" style="font-size: 2.5rem; font-weight: 700; color: var(--accent-crimson); display: block; font-family: 'Orbitron', sans-serif;">{{ stats.total_attendance_today }}</span>
                <span class="stat-label" style="font-size: 1rem; color: var(--text-secondary);">Attendance Today</span>
            </div>
            <div class="glass-card" style="padding: 15px; text-align: center;">
                <span class="stat-number" style="font-size: 2.5rem; font-weight: 700; color: var(--accent-violet); display: block; font-family: 'Orbitron', sans-serif;">{{ stats.total_attendance_week }}</span>
                <span class="stat-label" style="font-size: 1rem; color: var(--text-secondary);">This Week</span>
            </div>
            <div class="glass-card" style="padding: 15px; text-align: center;">
                <span class="stat-number" style="font-size: 2.5rem; font-weight: 700; color: var(--accent-teal); display: block; font-family: 'Orbitron', sans-serif;">{{ stats.total_attendance_month }}</span>
                <span class="stat-label" style="font-size: 1rem; color: var(--text-secondary);">This Month</span>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 30px;">
        <div class="glass-card">
            <div style="margin-bottom: 15px; border-bottom: 1px solid var(--glass-border); padding-bottom: 10px;">
                <h2 style="font-family: 'Orbitron', sans-serif; font-size: 1.5rem; color: var(--text-primary); margin: 0;">
                    <i class="fas fa-user-plus" style="color: var(--accent-crimson);"></i>
                    Student Management
                </h2>
            </div>
            <p class="mb-3" style="color: var(--text-secondary);">Register new students and manage existing records with face data.</p>
            <div style="display: flex; gap: 10px;">
                <a href="{{ url_for('add_student') }}" class="glass-button primary">
                    <i class="fas fa-plus"></i> Add Student
                </a>
                <a href="{{ url_for('students') }}" class="glass-button">
                    <i class="fas fa-list"></i> View All
                </a>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-brain"></i>
                    Face Training System
                </h2>
            </div>
            <p class="mb-3">Train the system to recognize individuals with multiple photos for enhanced accuracy.</p>
            <div class="d-flex gap-2">
                <a href="{{ url_for('face_training') }}" class="btn btn-primary">
                    <i class="fas fa-brain"></i> Start Training
                </a>
                <a href="{{ url_for('face_training') }}#trained-faces" class="btn btn-secondary">
                    <i class="fas fa-database"></i> Manage Training Data
                </a>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-camera"></i>
                    Face Recognition
                </h2>
            </div>
            <p class="mb-3">Photo-based attendance marking and group recognition.</p>
            <div class="d-flex gap-2">
                <a href="{{ url_for('recognition') }}" class="btn btn-primary">
                    <i class="fas fa-camera"></i> Recognition System
                </a>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-calendar-check"></i>
                    Attendance Tracking
                </h2>
            </div>
            <p class="mb-3">View and manage attendance records for all students.</p>
            <div class="d-flex gap-2">
                <a href="{{ url_for('attendance') }}" class="btn btn-primary">
                    <i class="fas fa-eye"></i> View Records
                </a>
                <a href="{{ url_for('attendance_today') }}" class="btn btn-success">
                    <i class="fas fa-calendar-day"></i> Today's Attendance
                </a>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-download"></i>
                    Data Export
                </h2>
            </div>
            <p class="mb-3">Download student and attendance data in CSV format.</p>
            <div class="d-flex gap-2">
                <a href="{{ url_for('export_data', data_type='students') }}" class="btn btn-primary">
                    <i class="fas fa-users"></i> Students CSV
                </a>
                <a href="{{ url_for('export_data', data_type='attendance') }}" class="btn btn-success">
                    <i class="fas fa-calendar"></i> Attendance CSV
                </a>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">
                <i class="fas fa-clock"></i>
                Recent Activity
            </h2>
        </div>
        
        {% if recent_attendance %}
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Student</th>
                        <th>ID</th>
                        <th>Date</th>
                        <th>Time</th>
                        <th>Method</th>
                        <th>Confidence</th>
                    </tr>
                </thead>
                <tbody>
                    {% for record in recent_attendance %}
                    <tr>
                        <td>{{ record.name }}</td>
                        <td>{{ record.student_id }}</td>
                        <td>{{ record.date }}</td>
                        <td>{{ record.time }}</td>
                        <td>
                            <span class="badge badge-{{ 'success' if record.method == 'camera' else 'warning' }}">
                                {{ record.method.title() }}
                            </span>
                        </td>
                        <td>
                            {% if record.confidence %}
                                <span class="badge badge-{{ 'success' if record.confidence|float > 0.8 else 'warning' }}">
                                    {{ "%.0f"|format(record.confidence|float * 100) }}%
                                </span>
                            {% else %}
                                <span class="badge badge-secondary">N/A</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-center">No recent attendance records found.</p>
        {% endif %}
    </div>

    <!-- System Information -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">
                <i class="fas fa-info-circle"></i>
                System Information
            </h2>
        </div>
        
        <div class="grid grid-3">
            <div class="text-center">
                <i class="fas fa-shield-alt" style="font-size: 2rem; color: var(--success-color);"></i>
                <h4 class="mt-2">Secure Storage</h4>
                <p>All data stored in encrypted CSV files with input validation</p>
            </div>
            <div class="text-center">
                <i class="fas fa-brain" style="font-size: 2rem; color: var(--primary-color);"></i>
                <h4 class="mt-2">ArcFace AI</h4>
                <p>High-accuracy face recognition using advanced neural networks</p>
            </div>
            <div class="text-center">
                <i class="fas fa-graduation-cap" style="font-size: 2rem; color: var(--warning-color);"></i>
                <h4 class="mt-2">Academic Focus</h4>
                <p>Designed specifically for educational institutions</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
