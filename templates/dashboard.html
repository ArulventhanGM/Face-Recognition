{% extends "base.html" %}

{% block title %}Dashboard - Face Recognition System{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="glass-card">
        <div class="card-header" style="border-bottom: 1px solid var(--glass-border); margin-bottom: 20px; padding-bottom: 15px;">
            <h1 class="card-title" style="font-family: 'Orbitron', sans-serif; margin: 0; color: var(--text-primary);">
                <i class="fas fa-tachometer-alt" style="color: var(--accent-teal);"></i>
                Admin Dashboard
            </h1>
            <span class="badge" style="background-color: var(--accent-teal); padding: 5px 10px; border-radius: 5px;">Welcome, {{ current_user.username }}</span>
        </div>
        
        <!-- Statistics -->
        <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
            <div class="glass-card" style="padding: 15px; text-align: center;">
                <span class="stat-number" style="font-size: 2.5rem; font-weight: 700; color: var(--accent-teal); display: block; font-family: 'Orbitron', sans-serif;">{{ stats.total_students }}</span>
                <span class="stat-label" style="font-size: 1rem; color: var(--text-secondary);">Registered Students</span>
            </div>
            <div class="glass-card" style="padding: 15px; text-align: center;">
                <span class="stat-number" style="font-size: 2.5rem; font-weight: 700; color: var(--accent-crimson); display: block; font-family: 'Orbitron', sans-serif;">{{ stats.total_attendance_today }}</span>
                <span class="stat-label" style="font-size: 1rem; color: var(--text-secondary);">Attendance Today</span>
            </div>
            <div class="glass-card" style="padding: 15px; text-align: center;">
                <span class="stat-number" style="font-size: 2.5rem; font-weight: 700; color: var(--accent-violet); display: block; font-family: 'Orbitron', sans-serif;">{{ stats.total_attendance_week }}</span>
                <span class="stat-label" style="font-size: 1rem; color: var(--text-secondary);">This Week</span>
            </div>
            <div class="glass-card" style="padding: 15px; text-align: center;">
                <span class="stat-number" style="font-size: 2.5rem; font-weight: 700; color: var(--accent-teal); display: block; font-family: 'Orbitron', sans-serif;">{{ stats.total_attendance_month }}</span>
                <span class="stat-label" style="font-size: 1rem; color: var(--text-secondary);">This Month</span>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 30px;">
        <div class="card black-glass">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-user-plus"></i>
                    Student Management
                </h2>
            </div>
            <p class="mb-3">Register new students and manage existing records with face data.</p>
            <div class="d-flex gap-2">
                <a href="{{ url_for('add_student') }}" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Add Student
                </a>
                <a href="{{ url_for('students') }}" class="btn btn-secondary">
                    <i class="fas fa-list"></i> View All
                </a>
            </div>
        </div>

        <div class="card black-glass">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-brain"></i>
                    Face Training System
                </h2>
            </div>
            <p class="mb-3">Train the system to recognize individuals with multiple photos for enhanced accuracy.</p>
            <div class="d-flex gap-2">
                <a href="{{ url_for('face_training') }}" class="btn btn-primary">
                    <i class="fas fa-brain"></i> Start Training
                </a>
                <a href="{{ url_for('face_training') }}#trained-faces" class="btn btn-secondary">
                    <i class="fas fa-database"></i> Manage Training Data
                </a>
            </div>
        </div>

        <div class="card black-glass">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-camera"></i>
                    Face Recognition
                </h2>
            </div>
            <p class="mb-3">Photo-based attendance marking and group recognition.</p>
            <div class="d-flex gap-2">
                <a href="{{ url_for('recognition') }}" class="btn btn-primary">
                    <i class="fas fa-camera"></i> Recognition System
                </a>
            </div>
        </div>

        <div class="card black-glass">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-calendar-check"></i>
                    Attendance Tracking
                </h2>
            </div>
            <p class="mb-3">View and manage attendance records for all students.</p>
            <div class="d-flex gap-2">
                <a href="{{ url_for('attendance') }}" class="btn btn-primary">
                    <i class="fas fa-eye"></i> View Records
                </a>
                <a href="{{ url_for('attendance_today') }}" class="btn btn-success">
                    <i class="fas fa-calendar-day"></i> Today's Attendance
                </a>
            </div>
        </div>

        <div class="card black-glass">
            <div class="card-header border-bottom border-light border-opacity-10">
                <h2 class="card-title text-cyan">
                    <i class="fas fa-download text-info"></i>
                    Data Export
                </h2>
            </div>
            <div class="card-body">
                <p class="mb-3 text-light opacity-75">Download student and attendance data in CSV format.</p>
                <div class="d-flex gap-3">
                    <a href="{{ url_for('export_data', data_type='students') }}" class="btn btn-outline-info btn-glow">
                        <i class="fas fa-users me-2"></i> Students CSV
                    </a>
                    <a href="{{ url_for('export_data', data_type='attendance') }}" class="btn btn-outline-mint btn-glow">
                        <i class="fas fa-calendar me-2"></i> Attendance CSV
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="card black-glass">
        <div class="card-header border-bottom border-light border-opacity-10">
            <h2 class="card-title text-cyan">
                <i class="fas fa-clock text-info"></i>
                Recent Activity
            </h2>
        </div>
        
        {% if recent_attendance %}
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-dark table-hover glass-table">
                    <thead>
                        <tr>
                            <th class="text-cyan">Student</th>
                            <th class="text-cyan">ID</th>
                            <th class="text-cyan">Date</th>
                            <th class="text-cyan">Time</th>
                            <th class="text-cyan">Method</th>
                            <th class="text-cyan">Confidence</th>
                        </tr>
                    </thead>
                <tbody>
                    {% for record in recent_attendance %}
                    <tr>
                        <td>{{ record.name }}</td>
                        <td>{{ record.student_id }}</td>
                        <td>{{ record.date }}</td>
                        <td>{{ record.time }}</td>
                        <td>
                            <span class="badge badge-{{ 'success' if record.method == 'camera' else 'warning' }}">
                                {{ record.method.title() }}
                            </span>
                        </td>
                        <td>
                            {% if record.confidence %}
                                <span class="badge badge-{{ 'success' if record.confidence|float > 0.8 else 'warning' }}">
                                    {{ "%.0f"|format(record.confidence|float * 100) }}%
                                </span>
                            {% else %}
                                <span class="badge badge-secondary">N/A</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            </div>
        </div>
        {% else %}
        <div class="card-body">
            <p class="text-center text-muted">
                <i class="fas fa-exclamation-circle me-2"></i>
                No recent attendance records found.
            </p>
        </div>
        {% endif %}
    </div>

    <!-- System Information -->
    <div class="card black-glass">
        <div class="card-header border-bottom border-light border-opacity-10">
            <h2 class="card-title text-cyan">
                <i class="fas fa-info-circle text-info"></i>
                System Information
            </h2>
        </div>
        <div class="card-body">
        
        <div class="grid grid-3">
            <div class="feature-card text-center">
                <i class="fas fa-shield-alt feature-icon"></i>
                <h4 class="mt-3 feature-title">Secure Storage</h4>
                <p class="feature-text">All data stored in encrypted CSV files with input validation</p>
            </div>
            <div class="feature-card text-center">
                <i class="fas fa-brain feature-icon"></i>
                <h4 class="mt-3 feature-title">ArcFace AI</h4>
                <p class="feature-text">High-accuracy face recognition using advanced neural networks</p>
            </div>
            <div class="feature-card text-center">
                <i class="fas fa-graduation-cap feature-icon"></i>
                <h4 class="mt-3 feature-title">Academic Focus</h4>
                <p class="feature-text">Designed specifically for educational institutions</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
